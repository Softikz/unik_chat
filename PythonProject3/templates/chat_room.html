<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>{{ chat_name }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
<div class="navbar">
  <a href="{{ url_for('chats') }}">‚¨Ö –ù–∞–∑–∞–¥</a>
  <a href="{{ url_for('profile') }}">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
</div>

<div class="container">
  <h2>–ß–∞—Ç: {{ chat_name }}</h2>

  <div id="chat-box">
    {% for msg in messages %}
      <div class="message"><b>{{ msg[0] }}</b> ({{ msg[2] }}): {{ msg[1] }}</div>
    {% endfor %}
  </div>

  <textarea id="msg" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>
  <button id="send">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
</div>

<script>
  const socket = io();
  const chat = "{{ chat_name }}";
  const sender = "{{ user.name }}";

  document.getElementById('send').onclick = () => {
    const msg = document.getElementById('msg').value;
    if (msg.trim()) {
      socket.emit('send_message', {chat, sender, message: msg});
      document.getElementById('msg').value = '';
    }
  };

  socket.on('receive_message', data => {
    const box = document.getElementById('chat-box');
    const div = document.createElement('div');
    div.classList.add('message');
    div.innerHTML = `<b>${data.sender}</b> (${data.timestamp}): ${data.message}`;
    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
  });
</script>
</body>
</html>
